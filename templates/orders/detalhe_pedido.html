{% extends 'shared/base.html' %}
{% load static %}
{% load custom_filters %}
{% block content %}

{% if pedido %}
<div class="card" style="margin-bottom: 120px;">
    <h1 class="cards__titulo" style="text-align: center; margin-top: 10px;">Detalhe Pedido</h1>
    <div class="card__info">
        <p class="card__titulo">ID do Pedido: {{pedido.idOrder}}</p>
        <p>Data do pedido: {{pedido.dateOrder}}</p>
        <p>Status do pedido : {{pedido.nameStatus}}</p>
        <p class="card__titulo">Items do pedido: </p>

        {% for produto in produtos %}
            <ul>
                <li> - {{ produto }}</li>
                <img src="{{produto.image}}" style="width: 20%; border-radius: 30px; padding: 10px 10px;"></img>
                {% if produto.is_kit %}
                    <p style="font-size: 15px;">O kit contém:</p>
                  {% for product in produto.products_kit %}
                    <p style="font-size: 15px;">-{{ product.name }}</p>
                    {% if arts %}
                    {% with art_data=product.idProduct|get_art:pedido.idOrder %}
                    <p>Status da arte: {{ art_data.status }}</p>
                    {% if pedido.nameStatus == "Aprovado" and art_data.status == "CONCLUÍDO" %}
                    <a href="{% url 'verifica_prototipo' pedido.idOrder product.idProduct art_data.id %}"><button class="btn btn-success col-12" style="width: 40%;">Verificar protótipo!</button></a>
                    {% endif %}
                    {% if pedido.nameStatus == "Aprovado" and art_data.status == "AGUARDANDO"%}
                    <a href="{% url 'arquivos_reprovados' art_data.id %}"><button class="btn btn-danger col-12" style="width: 40%;">Verificar motivo da reprovação.</button></a>
                    {% endif %}
                    {% endwith %}
                    {% else %}
                    <p>Status: Aguradando envio</p>
                    {% endif %}
                  {% endfor %}
                {% endif %}
                <p>Quantidade : {{produto.quantity}}</p>
                {% if produto.quantity > 1 %}
                  {% if arts %}
                  {% for arte in produto.product_id|get_art:pedido.idOrder %}
                  <p>Status da arte {{forloop.counter}}: {{ arte.status }}</p>
                  {% if pedido.nameStatus == "Aprovado" and arte.status == "CONCLUÍDO"%}
                  <a href="{% url 'verifica_prototipo' pedido.idOrder produto.product_id arte.id %}"><button class="btn btn-success col-12" style="width: 40%;">Verificar protótipo!</button></a>
                  {% endif %}
                  {% if pedido.nameStatus == "Aprovado" and arte.status == "AGUARDANDO"%}
                  <a href="{% url 'arquivos_reprovados' arte.id %}"><button class="btn btn-danger col-12" style="width: 40%;">Verificar motivo da reprovação.</button></a>
                  {% endif %}
                  {% endfor %}
                  {% else %}
                  <p>Status da arte: Aguardando envio</p>
                {% endif %}
                {% endif %}
                {% if produto.isCustomizeable and not produto.is_kit and produto.quantity == 1%}
                  {% if arts %}
                  {% with art_data=produto.product_id|get_art:pedido.idOrder %}
                    <p>Status da arte: {{ art_data.status }}</p>
                    {% if pedido.nameStatus == "Aprovado" and  art_data.status == "CONCLUÍDO"%}
                    <a href="{% url 'verifica_prototipo' pedido.idOrder produto.product_id art_data.id %}"><button class="btn btn-success col-12" style="width: 40%;">Verificar protótipo!</button></a>
                    {% endif %}
                    {% if pedido.nameStatus == "Aprovado" and art_data.status == "AGUARDANDO"%}
                    <a href="{% url 'arquivos_reprovados' art_data.id %}"><button class="btn btn-danger col-12" style="width: 40%;">Verificar motivo da reprovação.</button></a>
                    {% endif %}
                  {% endwith %}
                  {% else %}
                  <p>Status da arte: Aguardando envio</p>
                  {% endif %}
                {% endif %}
            </ul>
        {% endfor %}
        <p class="card__titulo">Total : {{pedido.order_total}}</p>
        <p class="card__titulo">Endereço para entrega:</p>
        <p>Rua: {{pedido.address.streetAddress}}</p>
        <p >Número: {{pedido.address.number}}</p>
        <p>Bairro: {{pedido.address.neighbourhood}}</p>
        <p>Cidade: {{pedido.address.city}}</p>
        <p>UF: {{pedido.address.state}}</p>
        <p>Quem recebe: {{pedido.address.receiver}}</p>
    </div>
            {% if pedido.nameStatus == "Aprovado" and  arts != produtos|length%}
            <a href="{% url 'envio_de_arte' pedido.idOrder 0 %}"><button class="btn btn-success col-12" style="width: 40%;">Personalize aqui!</button></a>
            {% endif %}

</div>
{% endif %}
{% endblock %}